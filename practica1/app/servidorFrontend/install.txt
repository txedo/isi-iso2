CREATE DATABASE bdssca CHARACTER SET utf8 COLLATE utf8_bin;
USE bdssca;

CREATE TABLE centros (
       id INT NOT NULL AUTO_INCREMENT,
       nombre VARCHAR(255) UNIQUE NOT NULL default '', 
       direccion VARCHAR(255) NOT NULL default '', 
       PRIMARY KEY (id)
) TYPE=InnoDB AUTO_INCREMENT=1;

CREATE TABLE usuarios (
       dni VARCHAR(255) NOT NULL, 
       login VARCHAR(255) UNIQUE NOT NULL default '',
       password VARCHAR(255) NOT NULL default '', 
       rol INT NOT NULL default '-1',
       nombre VARCHAR(255) NOT NULL default '',
       apellidos VARCHAR(255) NOT NULL default '',
       id_centro INT default '-1',
       PRIMARY KEY (dni),
       FOREIGN KEY (id_centro) REFERENCES centros (id) ON DELETE SET NULL ON UPDATE CASCADE
) TYPE=InnoDB;

CREATE TABLE tiposMedico (
       dniMedico VARCHAR(255) NOT NULL,
       tipo ENUM ('Cabecera', 'Pediatra', 'Especialista') NOT NULL,
       PRIMARY KEY (dniMedico),
       FOREIGN KEY (dniMedico) REFERENCES usuarios (dni) ON DELETE NO ACTION ON UPDATE CASCADE
) TYPE=InnoDB;

CREATE TABLE periodosTrabajo (
       id INT NOT NULL AUTO_INCREMENT,
       dni VARCHAR(255) NOT NULL,
       hora_inicio INT NOT NULL,
       hora_final INT NOT NULL,
       dia INT NOT NULL,
       PRIMARY KEY (id),
       FOREIGN KEY (dni) REFERENCES usuarios (dni) ON DELETE NO ACTION ON UPDATE CASCADE
) TYPE=InnoDB;

CREATE TABLE entradasLog (
       id INT NOT NULL AUTO_INCREMENT,
       usuario VARCHAR(255) NOT NULL,
       fecha TIMESTAMP NOT NULL,
       accion ENUM ('create', 'read', 'update', 'delete') NOT NULL,
       mensaje VARCHAR(255) NOT NULL,
       PRIMARY KEY (id)
) TYPE=InnoDB AUTO_INCREMENT=1;

CREATE TABLE beneficiarios (
       nif VARCHAR(255) NOT NULL,
       nss VARCHAR(255) UNIQUE NOT NULL,
       nombre VARCHAR(255) NOT NULL default '', 
       apellidos VARCHAR(255) NOT NULL default '',
       domicilio VARCHAR(255) NOT NULL default '',
       correo VARCHAR(255) NOT NULL default '',
       telefono INT NOT NULL default '-1',
       movil INT NOT NULL default '-1',
       edad INT NOT NULL default '-1',
       dniMedico VARCHAR(255) default '',
       PRIMARY KEY (nif),
       FOREIGN KEY (dniMedico) REFERENCES usuarios (dni) ON DELETE SET NULL ON UPDATE CASCADE
) TYPE=InnoDB;

CREATE TABLE citas (
       id INT NOT NULL AUTO_INCREMENT,
       fecha TIMESTAMP NOT NULL,
       duracion INT NOT NULL,
       dniBeneficiario VARCHAR(255) NOT NULL,
       dniMedico VARCHAR(255) NOT NULL,
       PRIMARY KEY (id),
       FOREIGN KEY (dniBeneficiario) REFERENCES beneficiarios (nif) ON DELETE CASCADE ON UPDATE CASCADE,
       FOREIGN KEY (dniMedico) REFERENCES usuarios (dni) ON DELETE CASCADE ON UPDATE CASCADE
) TYPE=InnoDB AUTO_INCREMENT=1;

CREATE TABLE volantes (
       id INT NOT NULL AUTO_INCREMENT,
       dniBeneficiario VARCHAR(255) NOT NULL,
       dniMedicoEmisor VARCHAR(255) NOT NULL,
       dniMedicoReceptor VARCHAR(255) NOT NULL,
       PRIMARY KEY (id),
       FOREIGN KEY (dniBeneficiario) REFERENCES beneficiarios (nif) ON DELETE CASCADE ON UPDATE CASCADE,
       FOREIGN KEY (dniMedicoEmisor) REFERENCES usuarios (dni) ON DELETE CASCADE ON UPDATE CASCADE,
       FOREIGN KEY (dniMedicoReceptor) REFERENCES usuarios (dni) ON DELETE CASCADE ON UPDATE CASCADE
) TYPE=InnoDB AUTO_INCREMENT=1;


INSERT INTO centros (nombre,direccion) VALUES ("Centro de Pruebas", "Paseo de la Universidad, 4");
INSERT INTO usuarios VALUES ("12345678", "admin" ,"admin", 0, "Foo", "Bar", 1);
INSERT INTO usuarios VALUES ("12345670", "citador" ,"citador", 1, "Foo", "Bar", 1);
INSERT INTO usuarios VALUES ("12345679", "medico" ,"medico", 2, "Foo", "Bar", 1);
